<h2>Avaliação</h2>

<mat-horizontal-stepper [linear]="true" #stepper>
	<ng-template matStepperIcon="edit">
		<i class="fa fa-edit"></i>
	</ng-template>
	<ng-template matStepperIcon="done">
		<i class="fa fa-check"></i>
	</ng-template>
	<mat-step [stepControl]="assessmentForm">
		<form [formGroup]="assessmentForm">
			<ng-template matStepLabel>Selecione um método de avaliação</ng-template>
			<div class="form-group" formGroupName="jsonAssessment">
				<mat-form-field class="full-width-input">
					<mat-select placeholder="Método de Avaliação" formControlName="measurementFramework"
								(selectionChange)="changeMeasurementFramework($event.value)" [disabled]="idAssessment"
								[ngClass]="{ 'is-invalid': submitted && f.jsonAssessment.controls.measurementFramework.errors }">
						<div *ngIf="!idAssessment">
							<mat-option *ngFor="let measurementFramework of measurementFrameworks"
										[value]="measurementFramework">
								{{measurementFramework.name}}
							</mat-option>
						</div>

						<mat-option *ngIf="idAssessment && measurementFramework" [value]="measurementFramework" disabled>
							{{measurementFramework.name}}
						</mat-option>
					</mat-select>
				</mat-form-field>
				<div *ngIf="submitted && f.jsonAssessment.controls.measurementFramework.errors?.required" class="invalid-feedback"
					 [ngClass]="{ 'display-block': submitted && f.jsonAssessment.controls.measurementFramework?.errors }">
					Método de Avaliação é obrigatório
				</div>
			</div>
			<div class="form-group">
				<button mat-raised-button class="btn btn-outline-danger" [routerLink]="['/assessment']">
					Cancelar
				</button>
				<button mat-raised-button class="mat-raised-button btn btn-outline-secondary" (click)="checkForms()"
						matStepperNext>Próximo
				</button>
			</div>
		</form>
	</mat-step>
	<mat-step [stepControl]="assessmentForm">
		<form [formGroup]="assessmentForm">
			<ng-template matStepLabel>Preencha as questões</ng-template>
			<div class="form-group" *ngIf="measurementFramework && referenceModel">
				<mat-tab-group mat-stretch-tabs class="example-stretched-tabs mat-elevation-z4">
					<mat-tab *ngFor="let knowledgeArea of referenceModel.knowledgeAreas" label="{{knowledgeArea.name}}">
						<mat-card *ngIf="hasQuestions(knowledgeArea)">
							<mat-card-content>
								<div class="purpose">{{knowledgeArea.purpose}}</div>
								<question-assessment [questions]="getQuestionsByKnowledgeArea(knowledgeArea)"
													 [results]="results"
													 [scaleValues]="scaleValues"
													 (onConfirmResult)="confirmResult($event)">
								</question-assessment>
							</mat-card-content>
						</mat-card>
					</mat-tab>
				</mat-tab-group>
			</div>
			<div class="form-group">
				<button mat-raised-button class="btn btn-outline-secondary" matStepperPrevious>Voltar</button>
				<button mat-raised-button (click)="onSubmit()" [disabled]="loading"
						class="btn btn-outline-success save-button">Salvar
				</button>
				<button mat-raised-button (click)="finish()" [disabled]="loading"
						class="btn btn-outline-success save-button">Salvar e Finalizar
				</button>
			</div>
		</form>
	</mat-step>
</mat-horizontal-stepper>
