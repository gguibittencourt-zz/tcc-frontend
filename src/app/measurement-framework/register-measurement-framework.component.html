<h2>Measurement Framework</h2>

<mat-horizontal-stepper [linear]="true" #stepper>
	<mat-step [stepControl]="measurementFrameworkForm">
		<form [formGroup]="measurementFrameworkForm">
			<ng-template matStepLabel>Preencha o nome e o modelo de referência</ng-template>
			<div class="form-group">
				<mat-form-field class="full-width-input">
					<input matInput formControlName="name" class="form-control" placeholder="Nome"
						   [ngClass]="{ 'is-invalid': submitted && f.name.errors }"/>
				</mat-form-field>
				<div *ngIf="submitted && f.name.errors" class="invalid-feedback">
					<div *ngIf="f.name.errors.required">Nome é obrigatório</div>
				</div>
				<mat-form-field class="full-width-input">
					<mat-select placeholder="Modelo de referência" formControlName="idReferenceModel"
								(selectionChange)="changeReferenceModel($event)"
								[ngClass]="{ 'is-invalid': submitted && f.idReferenceModel.errors }">
						<mat-option *ngFor="let referenceModel of referenceModels"
									[value]="referenceModel.idReferenceModel">
							{{referenceModel.name}}
						</mat-option>
					</mat-select>

				</mat-form-field>
				<div *ngIf="submitted && f.idReferenceModel.errors" class="invalid-feedback">
					<div *ngIf="f.idReferenceModel.errors.required">Modelo de referência é obrigatório</div>
				</div>
				<mat-form-field class="full-width-input">
					<mat-select placeholder="Tipo de questão" formControlName="type"
								(selectionChange)="changeTypeQuestion($event)"
								[ngClass]="{ 'is-invalid': submitted && f.type.errors }">
						<mat-option *ngFor="let type of types" [value]="type.idTypeQuestion">
							{{type.name}}
						</mat-option>
					</mat-select>
				</mat-form-field>
				<div *ngIf="submitted && f.type.errors" class="invalid-feedback">
					<div *ngIf="f.type.errors.required">Tipo de questão é obrigatório</div>
				</div>
			</div>
			<div class="form-group">
				<button mat-raised-button [routerLink]="['/measurement-framework']" class="btn btn-outline-danger">
					Cancelar
				</button>
				<button mat-button matStepperNext>Próximo</button>
			</div>
		</form>
	</mat-step>
	<mat-step [stepControl]="measurementFrameworkForm">
		<ng-template matStepLabel>Preencha as questões</ng-template>

		<form [formGroup]="measurementFrameworkForm">
			<tree-node-questions *ngIf="referenceModel" [knowledgeAreas]="referenceModel.knowledgeAreas"
								 [questions]="measurementFramework.questions"
								 [type]="type"
								 (onConfirmQuestions)="confirmQuestions($event)">
			</tree-node-questions>
		</form>

		<div class="form-group">
			<button mat-button matStepperPrevious>Voltar</button>
			<button mat-button matStepperNext>Próximo</button>
		</div>
	</mat-step>
	<mat-step [stepControl]="measurementFrameworkForm">
		<ng-template matStepLabel>Preencha as métricas</ng-template>

		<form [formGroup]="measurementFrameworkForm">
			<div *ngIf="type == 'boolean'">
				<tree-node-metrics-boolean *ngIf="referenceModel" [knowledgeAreas]="referenceModel.knowledgeAreas"
										   [goals]="measurementFramework.goals"
										   (onConfirmGoals)="confirmGoals($event)">
				</tree-node-metrics-boolean>
			</div>
			<div *ngIf="type == 'scale'">
				<tree-node-metrics-scale *ngIf="referenceModel"
										 [knowledgeAreas]="referenceModel.knowledgeAreas"
										 [goals]="measurementFramework.goals"
										 (onConfirmGoals)="confirmGoals($event)">
				</tree-node-metrics-scale>
			</div>
		</form>

		<div class="form-group">
			<button mat-button matStepperPrevious>Voltar</button>
			<button mat-raised-button (click)="onSubmit()" [disabled]="loading"
					class="btn btn-outline-success save-button">Salvar
			</button>
		</div>
	</mat-step>
</mat-horizontal-stepper>
